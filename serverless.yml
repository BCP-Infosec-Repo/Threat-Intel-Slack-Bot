service: threat-intel-bot

provider:
  name: aws
  runtime: python3.7
  region: us-west-1
  stage: dev
  environment:
    SLACK_API_TOKEN: "${self:custom.secrets.SLACK_API_TOKEN}"
    SLACK_CHANNEL: "${self:custom.secrets.SLACK_CHANNEL}"
    PASSIVETOTAL_USERNAME: "${self:custom.secrets.PASSIVETOTAL_USERNAME}"
    PASSIVETOTAL_APIKEY: "${self:custom.secrets.PASSIVETOTAL_APIKEY}"

functions:
  query:
    handler: query.handler
    events:
      - http:
          path: query
          method: any
          request:
            passThrough: WHEN_NO_MATCH

plugins:
  - serverless-python-requirements
custom:
  stage: ${opt:stage, self:provider.stage}
  secrets: ${file(secrets.yml):${self:custom.stage}}
  pythonRequirements:
    dockerizePip: non-linux

package:
  exclude:
    - secrets.yml
